H<- rain.long[(t- 1),"Hiiraan_rain"]
I<- fatalities.long[(t- 10),"Bari_Fatalities"]
J<- mean(fatalities.long[(t-6):(t- 1),"Togdheer_Fatalities"], na.rm=TRUE)
K<- before.long[(t- 8),"Awdal_BeforeRegion"]
L<- stations.long[(t- 15),"Gedo_LuuqStation_Juba_River"]
M<- before.long[(t- 1),"Bay_BeforeRegion"]
N<- mean(fatalities.long[(t-8):(t- 1),"Hiiraan_Fatalities"], na.rm=TRUE)
O<- max(H, I*J,na.rm=TRUE)
P<- max(K*L, 0.0187301275782267*M,na.rm=TRUE)
Q<- max(129.108864706647,sum( A*B , 0.000102684111890545*C^2*D , E , G , O , P , -129.108864706647,na.rm=TRUE),na.rm=TRUE)
if(is.infinite(Q)){Q <- 0 }
if(is.infinite(N)){N <- 0 }
FIN <-sum( Q , -N,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_AWJUN7arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- fatalities.long[(t- 1),"Bari_Fatalities"]
B<- water.long[(t- 1),"Sool_WaterDrumPrice"]
C<- tail(movavg(before.long[(t-8):(t- 1),"Shabeellaha_Hoose_BeforeRegion"], 7,type="m"),1)
D<- rain.long[(t- 14),"Shabeellaha_Hoose_rain"]
E<- future.long[(t- 1),"Togdheer_FutureRegion"]
G<- fatalities.long[(t- 1),"Bari_Fatalities"]
H<- conflicts.long[(t- 10),"Jubbada_Hoose_Conflict"]
I<- current.long[(t- 14),"Togdheer_CurrentRegion"]
J<- rain.long[(t- 1),"Awdal_rain"]
K<- fatalities.long[(t- 1),"Bari_Fatalities"]
L<- water.long[(t- 1),"Sool_WaterDrumPrice"]
M<- tail(movavg(before.long[(t-8):(t- 1),"Shabeellaha_Hoose_BeforeRegion"], 7,type="m"),1)
N<- current.long[(t- 14),"Togdheer_CurrentRegion"]
O<- rain.long[(t- 1),"Awdal_rain"]
P<- fatalities.long[(t- 1),"Bari_Fatalities"]
Q<- fatalities.long[(t- 1),"Bari_Fatalities"]
R<- sinh(0.00693433461640035*E)
S<- tan(42.4099473288014*G*H)
U<- tan(sum(0.702827245057452*I , J,na.rm=TRUE))
V<- tan(3.00767310120673e-8*K*L*M)
W<- max(sum(0.702827245057452*N , O,na.rm=TRUE), P,na.rm=TRUE)
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(C)){C <- 0 }
if(is.infinite(D)){D <- 0 }
if(is.infinite(R)){R <- 0 }
if(is.infinite(S)){S <- 0 }
if(is.infinite(U)){U <- 0 }
if(is.infinite(V)){V <- 0 }
if(is.infinite(W)){W <- 0 }
if(is.infinite(Q)){Q <- 0 }
FIN <-sum( 3.00767310120673e-8*A*B*C , D , R , S , U , V , W , -Q,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_AWJUN9arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- before.long[(t- 1),"Sool_BeforeRegion"]
B<- mean(before.long[(t-10):(t- 1),"Woqooyi_Galbeed_BeforeRegion"], na.rm=TRUE)
C<- median(before.long[(t-12):(t- 1),"Sool_BeforeRegion"], na.rm=TRUE)
D<- median(before.long[(t-13):(t- 1),"Togdheer_BeforeRegion"], na.rm=TRUE)
E<- mean(before.long[(t-7):(t- 1),"Woqooyi_Galbeed_BeforeRegion"], na.rm=TRUE)
G<- before.long[(t- 15),"Bari_BeforeRegion"]
H<- future.long[(t- 3),"Nugaal_FutureRegion"]
I<- conflicts.long[(t- 1),"Mudug_Conflict"]
J<- mean(fatalities.long[(t-3):(t- 1),"Togdheer_Fatalities"], na.rm=TRUE)
K<- median(before.long[(t-16):(t- 1),"Bari_BeforeRegion"], na.rm=TRUE)
L<- tail(movavg(before.long[(t-6):(t- 1),"Woqooyi_Galbeed_BeforeRegion"], 5,type="m"),1)
M<- fatalities.long[(t- 1),"Galguduud_Fatalities"]
N<- fatalities.long[(t- 1),"Jubbada_Dhexe_Fatalities"]
O<- max(0.584906959013989*H, 0.915165391007681*I*J,na.rm=TRUE)
P<- max(sum(G , O,na.rm=TRUE), K,na.rm=TRUE)
Q<- max(P, L,na.rm=TRUE)
R<- max(C*D/E, Q,na.rm=TRUE)
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(R)){R <- 0 }
if(is.infinite(M)){M <- 0 }
if(is.infinite(N)){N <- 0 }
FIN <-sum( 0.0115621443353209*A , 0.915165391007681*B , R , -M , -N,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_AWJUN8arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- before.long[(t- 15),"Bari_BeforeRegion"]
B<- current.long[(t- 15),"Jubbada_Dhexe_CurrentRegion"]
C<- median(before.long[(t-12):(t- 1),"Togdheer_BeforeRegion"], na.rm=TRUE)
D<- before.long[(t- 15),"Sool_BeforeRegion"]
E<- current.long[(t- 15),"Sool_CurrentRegion"]
G<- conflicts.long[(t- 1),"Mudug_Conflict"]
H<- fatalities.long[(t- 2),"Togdheer_Fatalities"]
I<- current.long[(t- 15),"Jubbada_Dhexe_CurrentRegion"]
J<- before.long[(t- 15),"Bari_BeforeRegion"]
K<- current.long[(t- 15),"Jubbada_Dhexe_CurrentRegion"]
L<- median(before.long[(t-12):(t- 1),"Togdheer_BeforeRegion"], na.rm=TRUE)
M<- before.long[(t- 15),"Sool_BeforeRegion"]
N<- current.long[(t- 15),"Sool_CurrentRegion"]
O<- current.long[(t- 15),"Jubbada_Dhexe_CurrentRegion"]
P<- tail(movavg(before.long[(t-9):(t- 1),"Woqooyi_Galbeed_BeforeRegion"], 8,type="m"),1)
Q<- fatalities.long[(t- 12),"Togdheer_Fatalities"]
R<- future.long[(t- 1),"Togdheer_FutureRegion"]
S<- before.long[(t- 15),"Bari_BeforeRegion"]
U<- rain.long[(t- 5),"Bakool_rain"]
V<- max(G*H, 0.00189690282163337*I,na.rm=TRUE)
W<- sum(0.566054870160388*J, 0.00189690282163337*K*L ,0.000116228953606384*M*N,na.rm=TRUE)%%0.00189690282163337*O
X<- max(0.566054870160388*S, U,na.rm=TRUE)
if ( is.na(Q) ){Y<- X}
else if(Q>0){Y<- 0.652241128913957*R }
else{Y<- X }
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(C)){C <- 0 }
if(is.infinite(D)){D <- 0 }
if(is.infinite(E)){E <- 0 }
if(is.infinite(V)){V <- 0 }
if(is.infinite(W)){W <- 0 }
if(is.infinite(P)){P <- 0 }
if(is.infinite(Y)){Y <- 0 }
FIN <-sum( 0.566054870160388*A , 0.00189690282163337*B*C , 0.000116228953606384*D*E , V*W , P , Y,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_AWJUN10arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- before.long[(t- 1),"Bay_BeforeRegion"]
B<- tail(movavg(future.long[(t-7):(t- 1),"Jubbada_Dhexe_FutureRegion"], 6,type="m"),1)
C<- mean(current.long[(t-9):(t- 1),"Gedo_CurrentRegion"], na.rm=TRUE)
D<- rain.long[(t- 1),"Bari_rain"]
E<- fatalities.long[(t- 8),"Nugaal_Fatalities"]
G<- fatalities.long[(t- 1),"Bari_Fatalities"]
H<- current.long[(t- 1),"Mudug_CurrentRegion"]
I<- fatalities.long[(t- 11),"Nugaal_Fatalities"]
J<- mean(fatalities.long[(t-14):(t- 1),"Bari_Fatalities"], na.rm=TRUE)
K<- rain.long[(t- 16),"Jubbada_Hoose_rain"]
L<- fatalities.long[(t- 3),"Banaadir_Fatalities"]
M<- max(I*J, 5.18603498698061*K,na.rm=TRUE)
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(C)){C <- 0 }
if(is.infinite(D)){D <- 0 }
if(is.infinite(E)){E <- 0 }
if(is.infinite(G)){G <- 0 }
if(is.infinite(H)){H <- 0 }
if(is.infinite(M)){M <- 0 }
if(is.infinite(L)){L <- 0 }
FIN <-sum( 0.0214444315046024*A , 0.0877600299841897*B , 0.0496708696239565*C , D*E , 9.72016887437201e-5*G^2*H , M , -L,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_BKminus1arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- tail(movavg(current.long[(t-5):(t- 1),"Togdheer_CurrentRegion"], 4,type="m"),1)
B<- fatalities.long[(t- 1),"Mudug_Fatalities"]
C<- fatalities.long[(t- 1),"Togdheer_Fatalities"]
D<- tail(movavg(current.long[(t-5):(t- 1),"Togdheer_CurrentRegion"], 4,type="m"),1)
E<- fatalities.long[(t- 1),"Mudug_Fatalities"]
G<- mean(future.long[(t-5):(t- 1),"Bari_FutureRegion"], na.rm=TRUE)
H<- fatalities.long[(t- 1),"Mudug_Fatalities"]
I<- rain.long[(t- 11),"Shabeellaha_Hoose_rain"]
J<- fatalities.long[(t- 2),"Nugaal_Fatalities"]
K<- future.long[(t- 6),"Sanaag_FutureRegion"]
L<- mean(future.long[(t-5):(t- 1),"Bari_FutureRegion"], na.rm=TRUE)
M<- stations.long[(t- 1),"Gedo_BardheereStation_Juba_River"]
N<- before.long[(t- 1),"Bakool_BeforeRegion"]
O<- before.long[(t- 1),"Bari_BeforeRegion"]
P<- before.long[(t- 1),"Sool_BeforeRegion"]
Q<- future.long[(t- 6),"Sanaag_FutureRegion"]
R<- tail(movavg(future.long[(t-5):(t- 1),"Togdheer_FutureRegion"], 4,type="m"),1)
if ( is.na(C) ){S<- G}
else if(C>0){S<-sum( 0.187458533192864*D , E,na.rm=TRUE) }
else{S<- G }
U<- max(sum(H*I , 2.24184551449069*J*K,na.rm=TRUE), L,na.rm=TRUE)
V<- O%% P
W<- min(N, V,na.rm=TRUE)
X<- max(U,sum( 1.37452697035014*M*W , Q,na.rm=TRUE),na.rm=TRUE)
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(S)){S <- 0 }
if(is.infinite(X)){X <- 0 }
if(is.infinite(R)){R <- 0 }
FIN <-sum( 0.187458533192864*A , B , S , X , -R,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_BKminus2arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- mean(fatalities.long[(t-5):(t- 2),"Nugaal_Fatalities"], na.rm=TRUE)
B<- before.long[(t- 2),"Woqooyi_Galbeed_BeforeRegion"]
C<- tail(movavg(conflicts.long[(t-4):(t- 2),"Nugaal_Conflict"], 2,type="m"),1)
D<- before.long[(t- 2),"Woqooyi_Galbeed_BeforeRegion"]
E<- rain.long[(t- 12),"Hiiraan_rain"]
G<- fatalities.long[(t- 2),"Shabeellaha_Dhexe_Fatalities"]
H<- before.long[(t- 7),"Nugaal_BeforeRegion"]
I<- current.long[(t- 11),"Togdheer_CurrentRegion"]
J<- future.long[(t- 12),"Gedo_FutureRegion"]
K<- future.long[(t- 2),"Sool_FutureRegion"]
L<- future.long[(t- 2),"Sool_FutureRegion"]
M<- goats.long[(t- 2),"Mudug_goatprice"]
N<- cosh(C)
O<- cosh(0.0033592382798024*D)
P<- factorial(G)
Q<- E%% P
R<- max(J, 20.7751453551968*K,na.rm=TRUE)
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(N)){N <- 0 }
if(is.infinite(O)){O <- 0 }
if(is.infinite(Q)){Q <- 0 }
if(is.infinite(H)){H <- 0 }
if(is.infinite(I)){I <- 0 }
if(is.infinite(R)){R <- 0 }
if(is.infinite(L)){L <- 0 }
if(is.infinite(M)){M <- 0 }
FIN <-sum( A^2 , 0.0033592382798024*B^2 , N*O*Q , H , I , R , -1.558669469668e-5*L*M,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_BK1arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- mean(rain.long[(t-5):(t- 1),"Bay_rain"], na.rm=TRUE)
B<- mean(future.long[(t-17):(t- 1),"Nugaal_FutureRegion"], na.rm=TRUE)
C<- median(before.long[(t-13):(t- 1),"Jubbada_Dhexe_BeforeRegion"], na.rm=TRUE)
D<- before.long[(t- 1),"Bari_BeforeRegion"]
E<- before.long[(t- 1),"Woqooyi_Galbeed_BeforeRegion"]
G<- stations.long[(t- 1),"Gedo_DollowStation_Juba_River"]
H<- median(before.long[(t-9):(t- 1),"Mudug_BeforeRegion"], na.rm=TRUE)
I<- before.long[(t- 1),"Bari_BeforeRegion"]
J<- before.long[(t- 6),"Woqooyi_Galbeed_BeforeRegion"]
K<- mean(fatalities.long[(t-4):(t- 1),"Gedo_Fatalities"], na.rm=TRUE)
L<- fatalities.long[(t- 1),"Jubbada_Dhexe_Fatalities"]
M<- fatalities.long[(t- 9),"Sool_Fatalities"]
N<- mean(rain.long[(t-8):(t- 1),"Bakool_rain"], na.rm=TRUE)
O<- before.long[(t- 7),"Nugaal_BeforeRegion"]
P<- median(future.long[(t-3):(t- 1),"Woqooyi_Galbeed_FutureRegion"], na.rm=TRUE)
Q<- max(I, J,na.rm=TRUE)
R<- max(H, Q,na.rm=TRUE)
S<- sin(K)
if ( is.na(S) ){U<- O}
else if(S>0){U<- L*M*N }
else{U<- O }
V<- max(C,sum( 0.00547268244611714*D*E*G , R , U,na.rm=TRUE),na.rm=TRUE)
W<- max(B,sum( V , -P,na.rm=TRUE),na.rm=TRUE)
if ( is.na(A) ){X<- 7723}
else if(A>0){X<- W }
else{X<- 7723 }
FIN <-X
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_BK2arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- before.long[(t- 1),"Bari_BeforeRegion"]
B<- tail(movavg(fatalities.long[(t-3):(t- 1),"Jubbada_Hoose_Fatalities"],2,type="w"),1)
C<- fatalities.long[(t- 1),"Shabeellaha_Hoose_Fatalities"]
D<- current.long[(t- 1),"Gedo_CurrentRegion"]
E<- before.long[(t- 1),"Bari_BeforeRegion"]
G<- future.long[(t- 13),"Shabeellaha_Hoose_FutureRegion"]
H<- before.long[(t- 1),"Sool_BeforeRegion"]
I<- tail(movavg(current.long[(t-6):(t- 1),"Togdheer_CurrentRegion"], 5,type="m"),1)
J<- conflicts.long[(t- 1),"Shabeellaha_Dhexe_Conflict"]
K<- rain.long[(t- 7),"Awdal_rain"]
L<- rain.long[(t- 10),"Nugaal_rain"]
M<- tail(movavg(current.long[(t-6):(t- 1),"Togdheer_CurrentRegion"], 5,type="m"),1)
N<- fatalities.long[(t- 1),"Shabeellaha_Hoose_Fatalities"]
O<- tail(movavg(fatalities.long[(t-15):(t- 1),"Nugaal_Fatalities"], 14,type="m"),1)
P<- before.long[(t- 1),"Bari_BeforeRegion"]
Q<- future.long[(t- 13),"Shabeellaha_Hoose_FutureRegion"]
R<- future.long[(t- 1),"Togdheer_FutureRegion"]
S<- min(sum(E , G,na.rm=TRUE), H,na.rm=TRUE)
U<- atan2(L, M)
V<- max(0.348051001851398*I, 3.01969783475628*J*K*U,na.rm=TRUE)
W<- max(sum(0.00042444201330642*D*S , V,na.rm=TRUE), N*O,na.rm=TRUE)
if ( is.na(C) ){X<-sum( P , Q,na.rm=TRUE)}
else if(C>0){X<- W }
else{X<-sum( P , Q,na.rm=TRUE) }
if(is.infinite(A)){A <- 0 }
if(is.infinite(B)){B <- 0 }
if(is.infinite(X)){X <- 0 }
if(is.infinite(R)){R <- 0 }
FIN <-sum( A , B , X , -R,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
modelarrivals_BK3arrivals <- function(start, end){
start = 20
PI <- PA <- PD <- rep(NA, end)
for (t in start:end){
A<- median(before.long[(t-7):(t- 1),"Woqooyi_Galbeed_BeforeRegion"], na.rm=TRUE)
B<- future.long[(t- 17),"Gedo_FutureRegion"]
C<- fatalities.long[(t- 4),"Shabeellaha_Dhexe_Fatalities"]
D<- rain.long[(t- 4),"Togdheer_rain"]
E<- current.long[(t- 1),"Togdheer_CurrentRegion"]
G<- water.long[(t- 1),"Woqooyi_Galbeed_WaterDrumPrice"]
H<- conflicts.long[(t- 1),"Awdal_Conflict"]
I<- rain.long[(t- 6),"Togdheer_rain"]
J<- fatalities.long[(t- 4),"Shabeellaha_Dhexe_Fatalities"]
K<- before.long[(t- 1),"Bari_BeforeRegion"]
L<- current.long[(t- 1),"Gedo_CurrentRegion"]
M<- rain.long[(t- 4),"Togdheer_rain"]
N<- before.long[(t- 1),"Bari_BeforeRegion"]
O<- future.long[(t- 17),"Gedo_FutureRegion"]
P<- sinh(H)
Q<- max(sum(0.271694412738264*E , 0.227492977114644*G,na.rm=TRUE), P,na.rm=TRUE)
if ( is.na(J) ){R<- M}
else if(J>0){R<- 0.000499709523595132*K*L }
else{R<- M }
if ( is.na(I) ){S<- N}
else if(I>0){S<- R }
else{S<- N }
U<- max(C*D,sum( Q , S , -O,na.rm=TRUE),na.rm=TRUE)
V<- max(B, U,na.rm=TRUE)
W<- max(V, 2098.54979385953,na.rm=TRUE)
if(is.infinite(A)){A <- 0 }
if(is.infinite(W)){W <- 0 }
FIN <-sum( A , W , -1964.5044460368,na.rm=TRUE)
PA[t] <- FIN
PI[t] <- 0
PD[t] <- 0
}
return(PA)
}
monthStart <- function(x) {
x <- as.POSIXlt(x)
x$mday <- 1
as.Date(x)
}
date_index <- function(x){
full.date <- as.POSIXct(x, tz="GMT")
index <- which(current.long$Date == monthStart(full.date))
return(index)
}
url <- "https://docs.google.com/spreadsheets/d/15qJuLfwCEf65D82EY9td8DdCPK3prFi2qyMQ-MhsOdU/edit?usp=sharing"
predictions <- gsheet2text(url, sheetid = 1646195000)
predictions.long <- read.csv(text = predictions)
find_index <- function(x){
index <- which(predictions.long$Date == x)
return(index)
}
current_month = toString(as.numeric(format(Sys.Date(),'%m')))
current_year = format(Sys.Date(), '%y')
current_date = paste(current_month,"1",current_year,sep="/")
all_regions = c("Awdal","Bay","Bakool","Banadir","Gedo", "Middle Juba", "Lower Juba",
"Middle Shabelle", "Lower Shabelle", "Hiiraan", "Galgaduud",
"Mudug","Nugaal", "Bari", "Sanaag", "Sool", "Togdheer", "Woqooyi Galbeed")
start_point <- find_index(current_date)
region <- input$region
fmonths_start <- which(current.long$Date == monthStart(as.Date("2017-02-01")))
fmonths_start <- which(current.long$Date == monthStart(as.Date("2017-02-01")))
fmonths_end <- which(current.long$Date == monthStart(as.Date("2018-06-01")))
library(rCharts)
library(shiny)
library(plotly)
library(ggplot2)
library(datasets)
library(magrittr)
library(XML)
library(reshape)
library(gsheet)
library(scales)
library(zoo)
library(pracma)
library(psych)
library(devtools)
library(rmarkdown)
library(astro)
# Use the google spreadsheet
collected_data <- "https://docs.google.com/spreadsheets/d/1oPTPmoJ9phtMOkp-nMB7WHnPESomLzqUj9t0gcE9bYA"
conflicts <- gsheet2text(collected_data, sheetid = 819472314)
conflicts.long <- read.csv(text=conflicts)
before <-gsheet2text(collected_data, sheetid = 457614883)
before.long <- read.csv(text=before)
#arrs.long <- head(arrs.long, -30)
future <-gsheet2text(collected_data, sheetid = 677621454)
future.long <-read.csv(text=future)
#deps.long <- head(deps.long, -30)
current <-gsheet2text(collected_data, sheetid = 772694153)
current.long <-read.csv(text=current)
rain <-gsheet2text(collected_data, sheetid = 1473662223)
rain.long <- read.csv(text=rain,stringsAsFactors = FALSE)
#rain.long <- head(rain.long, -30)
#read the WaterDrumPrices
water <-gsheet2text(collected_data, sheetid =27261871)
water.long <- read.csv(text=water,stringsAsFactors = FALSE)
water.long$Date <-as.Date(water.long$Date, format="%m/%d/%Y")
#water.long <- data.frame(cbind(sapply(water.long[,sapply(water.long,is.character)],trimws,which="both"),water.long[,!sapply(df,is.character)]))
water.long[,1:ncol(water.long)] <- sapply(water.long[,1:ncol(water.long)],as.numeric)
#read the Rivers
rivers <-gsheet2text(collected_data, sheetid =407366559)
rivers.long <- read.csv(text=rivers,stringsAsFactors = FALSE)
#read the Goat Prices
goats <-gsheet2text(collected_data, sheetid =1601716765)
goats.long <- read.csv(text=goats,stringsAsFactors = FALSE)
#read the Fatalities
fatalities <-gsheet2text(collected_data, sheetid =343810263)
fatalities.long <- read.csv(text=fatalities,stringsAsFactors = FALSE)
discharge <- gsheet2text(collected_data, sheetid=407366559)
discharge.long <- read.csv(text=discharge,stringsAsFactors = FALSE)
stations <- gsheet2text(collected_data, sheetid=1052168743)
stations.long <- read.csv(text=stations,stringsAsFactors = FALSE)
cash <- gsheet2text(collected_data, sheetid = 161900539)
cash.long <- read.csv(text=cash,stringsAsFactors = FALSE)
cases <- gsheet2text(collected_data, sheetid = 15526228)
cases.long <- read.csv(text=cases,stringsAsFactors = FALSE)
deaths <- gsheet2text(collected_data, sheetid = 2060381151)
deaths.long <- read.csv(text=deaths,stringsAsFactors = FALSE)
dollos <- gsheet2text(collected_data, sheetid = 1111574539)
dollos.long <- read.csv(text=dollos,stringsAsFactors = FALSE)
Dates <- sapply(conflicts.long[,1],as.character.Date)
conflicts.long$Date <- as.Date(conflicts.long$Date, format="%m/%d/%Y")
before.long$Date <- as.Date(before.long$Date, format="%m/%d/%Y")
future.long$Date <- as.Date(future.long$Date, format="%m/%d/%Y")
current.long$Date <- as.Date(current.long$Date, format="%m/%d/%Y")
rain.long$Date <-as.Date(rain.long$Date, format="%m/%d/%Y")
rivers.long$Date <-as.Date(rivers.long$Date, format="%m/%d/%Y")
goats.long$Date <-as.Date(goats.long$Date, format="%m/%d/%Y")
fatalities.long$Date <-as.Date(fatalities.long$Date, format="%m/%d/%Y")
stations.long$Date <-as.Date(stations.long$Date, format="%m/%d/%Y")
cash.long$Date <-as.Date(cash.long$Date, format="%m/%d/%Y")
cases.long$Date <-as.Date(cases.long$Date, format="%m/%d/%Y")
deaths.long$Date <-as.Date(deaths.long$Date, format="%m/%d/%Y")
dollos.long$Date <-as.Date(dollos.long$Date, format="%m/%d/%Y")
# Force columns to be text
conflicts.long[,2:ncol(conflicts.long)] <- sapply(conflicts.long[,2:ncol(conflicts.long)], as.numeric)
before.long[,2:ncol(before.long)] <- sapply(before.long[,2:ncol(before.long)], as.numeric)
future.long[,2:ncol(future.long)] <- sapply(future.long[,2:ncol(future.long)], as.numeric)
current.long[,2:ncol(current.long)] <- sapply(current.long[,2:ncol(current.long)], as.numeric)
rain.long[,2:ncol(rain.long)] <- sapply(rain.long[,2:ncol(rain.long)], as.numeric)
rivers.long[,2:ncol(rivers.long)] <- sapply(rivers.long[,2:ncol(rivers.long)], as.numeric)
goats.long[,2:ncol(goats.long)] <- sapply(goats.long[,2:ncol(goats.long)], as.numeric)
fatalities.long[,2:ncol(fatalities.long)] <- sapply(fatalities.long[,2:ncol(fatalities.long)], as.numeric)
stations.long[,2:ncol(stations.long)] <- sapply(stations.long[,2:ncol(stations.long)], as.numeric)
cash.long[,2:ncol(cash.long)] <- sapply(cash.long[,2:ncol(cash.long)], as.numeric)
cases.long[,2:ncol(cases.long)] <- sapply(cases.long[,2:ncol(cases.long)], as.numeric)
deaths.long[,2:ncol(deaths.long)] <- sapply(deaths.long[,2:ncol(deaths.long)], as.numeric)
dollos.long[,2:ncol(dollos.long)] <- sapply(dollos.long[,2:ncol(dollos.long)], as.numeric)
monthStart <- function(x) {
x <- as.POSIXlt(x)
x$mday <- 1
as.Date(x)
}
date_index <- function(x){
full.date <- as.POSIXct(x, tz="GMT")
index <- which(current.long$Date == monthStart(full.date))
return(index)
}
url <- "https://docs.google.com/spreadsheets/d/15qJuLfwCEf65D82EY9td8DdCPK3prFi2qyMQ-MhsOdU/edit?usp=sharing"
predictions <- gsheet2text(url, sheetid = 1646195000)
predictions.long <- read.csv(text = predictions)
find_index <- function(x){
index <- which(predictions.long$Date == x)
return(index)
}
current_month = toString(as.numeric(format(Sys.Date(),'%m')))
current_year = format(Sys.Date(), '%y')
current_date = paste(current_month,"1",current_year,sep="/")
all_regions = c("Awdal","Bay","Bakool","Banadir","Gedo", "Middle Juba", "Lower Juba",
"Middle Shabelle", "Lower Shabelle", "Hiiraan", "Galgaduud",
"Mudug","Nugaal", "Bari", "Sanaag", "Sool", "Togdheer", "Woqooyi Galbeed")
start_point <- find_index(current_date)
region <- input$region
fmonths_start <- which(current.long$Date == monthStart(as.Date("2017-02-01")))
fmonths_end <- which(current.long$Date == monthStart(as.Date("2018-06-01")))
if(region == "Bay"){
reg_arr <- paste("Bay","CurrentRegion",sep="_")
A <- current.long[ fmonths_start:fmonths_end, reg_arr ]
}
region<-'Awdal'
reg_arr <- paste("Banadir","CurrentRegion",sep="_")
A <- current.long[ fmonths_start:fmonths_end, reg_arr ]
runApp()
